<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üíñ DE Drill ‚Äî Cute Mode</title>
  <!-- Pretty math -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]]},svg:{fontCache:'global'}};</script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
  <style>
    :root{
      --bg:#fff6fb; --panel:#ffffff; --ink:#3a2a35; --muted:#8e6a82; --accent:#ff6fb5; --accent2:#ffc3e7; --line:#f6d7eb; --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444;
    }
    html,body{height:100%}
    body{margin:0; background:radial-gradient(1200px 800px at 20% -10%, #ffe5f3 0, var(--bg) 55%); color:var(--ink); font-family: 'KaTeX_Main', ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    .app{display:grid; grid-template-columns:260px 1fr; min-height:100vh}
    header.top{grid-column:1 / -1; background:linear-gradient(180deg,#fff, #ffe9f6); border-bottom:1px solid var(--line); padding:12px 18px; display:flex; align-items:center; justify-content:space-between}
    .brand{display:flex; align-items:center; gap:10px; font-weight:900}
    .brand .spark{filter:drop-shadow(0 2px 4px rgba(255,111,181,.4))}
    .topstats{display:flex; align-items:center; gap:16px}
    .meter{display:flex; align-items:center; gap:10px}
    .ring{width:46px; height:46px; border-radius:50%; background:conic-gradient(var(--accent) 0deg, var(--line) 0deg); display:grid; place-items:center; border:2px solid #ffe3f2; color:#db2e89; font-weight:800}

    aside.sidebar{border-right:1px solid var(--line); background:#fff;}
    .sidewrap{padding:16px}
    .slabel{font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:.06em; margin:4px 0 8px}
    .skill{display:flex; align-items:center; justify-content:space-between; gap:10px; background:var(--panel); border:2px dashed var(--line); border-radius:14px; padding:10px 12px; margin-bottom:10px; cursor:pointer}
    .skill:hover{border-color:#ffc7e8}
    .skill.active{border-style:solid; border-color:#ffb3df; background:linear-gradient(180deg,#fff,#fff4fb)}
    .pill{font-size:12px; color:#cf5aa3; background:#fff0fa; border:1px solid #ffd4eb; border-radius:999px; padding:2px 8px}

    main.content{padding:20px; display:flex; justify-content:center}
    .card{max-width:940px; flex:1; background:var(--panel); border:1px solid var(--line); border-radius:22px; box-shadow:0 16px 38px rgba(255,111,181,.12); padding:18px}
    .prompt{font-size:19px; line-height:1.6}
    .controls{display:flex; flex-wrap:wrap; gap:10px; margin-top:12px}

    input[type="text"], textarea{flex:1; min-width:320px; background:#fff9fd; border:2px solid #ffd4eb; border-radius:14px; padding:12px 14px; font-size:16px; color:var(--ink); box-shadow:inset 0 1px 0 #fff}
    input[type="text"]::placeholder{color:#caa6bd}
    button{border-radius:12px; border:1px solid var(--line); padding:10px 14px; cursor:pointer; font-weight:800}
    button.primary{background:var(--accent); color:white; border-color:transparent; box-shadow:0 6px 14px rgba(255,111,181,.35)}
    button.ghost{background:#fff0fa; color:#b64f8f}

    .feedback{margin-top:10px; font-size:15px}
    .ok{color:var(--ok)} .bad{color:var(--bad)} .warn{color:var(--warn)}

    details{margin-top:10px}
    summary{cursor:pointer; color:#d43f94}

    .footerbar{margin-top:14px; display:flex; align-items:center; justify-content:space-between; gap:16px}
    .progress{flex:1; height:12px; background:#ffe8f4; border-radius:999px; overflow:hidden; border:1px solid #ffd4eb}
    .progress > div{height:100%; width:0%; background:linear-gradient(90deg, #ff8fc9, #ffd1ec)}
    .stats{display:flex; gap:14px; color:var(--muted); font-size:13px}

    .kbd{background:#fff0fa; border:1px solid #ffd4eb; padding:2px 6px; border-radius:6px; font-size:12px}
    .emoji{filter:drop-shadow(0 1px 0 rgba(255,111,181,.35))}
  </style>
</head>
<body>
  <div class="app">
    <header class="top">
      <div class="brand"><span class="spark">‚ú®</span><span>DE Drill ‚Ä¢ Cute</span><span class="spark">‚ú®</span></div>
      <div class="topstats">
        <div>‚≠ê Score: <b id="score">0</b></div>
        <div>üî• Streak: <b id="streak">0</b></div>
        <div class="meter"><div class="ring" id="ring"><span id="mastery">0</span></div><div style="font-weight:700;color:#c14290">Mastery</div></div>
      </div>
    </header>

    <aside class="sidebar">
      <div class="sidewrap">
        <div class="slabel">Skills</div>
        <div class="skill" data-topic="sep"><div class="name">Separable ODEs ‚ú®</div><div class="pill">solve y(t)</div></div>
        <div class="skill" data-topic="lin"><div class="name">Linear ODEs (IF) üå∏</div><div class="pill">solve y(x)</div></div>
        <div class="skill" data-topic="growth"><div class="name">Growth/Decay üå±</div><div class="pill">applications</div></div>
        <div class="skill" data-topic="cooling"><div class="name">Newton Cooling üßä</div><div class="pill">applications</div></div>
        <div class="skill" data-topic="concept"><div class="name">Existence & Uniqueness üí°</div><div class="pill">concept quiz</div></div>
      </div>
    </aside>

    <main class="content">
      <div class="card">
        <div class="prompt" id="prompt">Pick a skill on the left, then press <span class="kbd">New Q</span>. I‚Äôll make it pretty üå∑</div>
        <div class="controls">
          <input id="answer" type="text" placeholder="Type y(t) or y(x), or select an option below‚Ä¶" />
          <button id="newQ" class="ghost">New Q</button>
          <button id="check" class="primary">Check ‚úÖ</button>
          <button id="hintBtn" class="ghost">Hint üí°</button>
          <button id="solnBtn" class="ghost">Solution üß©</button>
        </div>
        <div id="mcq" style="margin-top:8px; display:none"></div>
        <div id="feedback" class="feedback"></div>
        <details id="hintBox"><summary>Hint</summary><div id="hint"></div></details>
        <details id="solnBox"><summary>Solution</summary><div id="solution"></div></details>

        <div class="footerbar">
          <div class="progress"><div id="progInner"></div></div>
          <div class="stats">
            <div>Correct: <b id="correctToday">0</b></div>
            <div>Attempts: <b id="attemptsToday">0</b></div>
            <div>Acc: <b id="accToday">0%</b></div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
  // üéÄ persistence
  const SKEY='de-cute-v1';
  const today=()=>new Date().toISOString().slice(0,10);
  const load=()=>JSON.parse(localStorage.getItem(SKEY)||'{}');
  const save=s=>localStorage.setItem(SKEY, JSON.stringify(s));
  function state(){const s=load(); const d=today(); s[d]=s[d]||{attempts:0,correct:0,score:0,streak:0,mastery:0}; return s}
  function put(ns){save(ns); renderProgress()}
  function bump(ok){const ns=state(); const d=today(); const t=ns[d]; t.attempts++; if(ok){t.correct++; t.score+=10; t.streak++; t.mastery=Math.min(100, t.mastery + (t.streak>=3?10:7)); confetti();} else {t.streak=0; t.mastery=Math.max(0, t.mastery-3)}; put(ns)}
  function renderProgress(){const s=state(); const d=today(); const t=s[d]; byId('score').textContent=t.score; byId('streak').textContent=t.streak; byId('correctToday').textContent=t.correct; byId('attemptsToday').textContent=t.attempts; byId('accToday').textContent=t.attempts? Math.round(100*t.correct/t.attempts)+'%':'0%'; byId('mastery').textContent=t.mastery; byId('ring').style.background=`conic-gradient(var(--accent) ${t.mastery*3.6}deg, var(--line) ${t.mastery*3.6}deg)`; byId('progInner').style.width=t.mastery+'%'; }

  // ‚ú® helpers
  const byId=id=>document.getElementById(id);
  const choice=a=>a[Math.floor(Math.random()*a.length)];
  const rand=(a,b)=>Math.random()*(b-a)+a; const randint=(a,b)=>Math.floor(rand(a,b+1));
  function latex(){ if(window.MathJax && MathJax.typeset) MathJax.typeset(); }
  function sanitize(expr){ if(!expr) return ''; expr=expr.replace(/\s+/g,''); expr=expr.replace(/\^/g,'**'); expr=expr.replace(/pi/gi,'Math.PI'); expr=expr.replace(/e(?![a-zA-Z0-9_])/g,'Math.E'); expr=expr.replace(/sin\(/gi,'Math.sin(').replace(/cos\(/gi,'Math.cos(').replace(/tan\(/gi,'Math.tan(').replace(/log\(/gi,'Math.log(').replace(/exp\(/gi,'Math.exp(').replace(/sqrt\(/gi,'Math.sqrt('); return expr }
  function compileScalar(expr, vars){const s=sanitize(expr); try{return new Function(...vars, `return (${s});`)}catch(e){return null}}
  function numDeriv(f,t){const h=1e-5*(1+Math.abs(t)); return (f(t+h)-f(t-h))/(2*h)}
  function relClose(a,b){const tol=1e-2 + 1e-3*Math.abs(b); return Math.abs(a-b)<=tol}

  // üéà confetti (emoji sparkles)
  function confetti(){ const el=document.createElement('div'); el.style.position='fixed'; el.style.left='50%'; el.style.top='18px'; el.style.transform='translateX(-50%)'; el.style.fontSize='24px'; el.textContent='‚ú®üå∏üíñ‚ú®'; el.style.transition='all .9s ease'; el.style.opacity='1'; document.body.appendChild(el); requestAnimationFrame(()=>{ el.style.top='-40px'; el.style.opacity='0'; }); setTimeout(()=> el.remove(), 1000); }

  // üß™ generators
  // Separable: dy/dt = a t^m * (y-b)
  function gen_sep(){ const a=choice([1,2,3]) * choice([1,-1]); const m=choice([0,1,2]); const b=choice([-2,-1,0,1,2]); const t0=0; const y0=choice([-2,-1,1,2]); const prompt=`Solve the separable ODE $$\frac{dy}{dt} = ${a}\,t^{${m}}\,(y-${b})\quad\text{with}\quad y(${t0})=${y0}.$$ Enter a function of <code>t</code> for $y(t)$.`; const hint=`Let $u=y-${b}$. Then $\dfrac{du}{dt} = ${a}\,t^{${m}} u$. Solve $u'=(${a})t^{${m}}u$ ‚Üí $u=C\,\exp\!\left(\dfrac{${a}}{${m+1}}t^{${m+1}}\right)$, then use $y(${t0})=${y0}$.`; const C = (y0-b); const sol = t=> b + C*Math.exp( (a/(m+1))*Math.pow(t, m+1) ); const solutionHTML = `$$y(t) = ${b} + (${y0-${b}})\exp\!\left(\dfrac{${a}}{${m+1}}t^{${m+1}}\right).$$`; return {type:'func', var:'t', ic:{t0,y0}, prompt, hint, truth:sol, solutionHTML, ode:(t,y)=> a*Math.pow(t,m)*(y-b)} }

  // Linear (integrating factor): y' + p y = q, with constants
  function gen_lin(){ const p=choice([1,2,3]) * choice([1,-1]); const q=choice([-2,-1,1,2]); const x0=0; const y0=choice([-2,-1,0,2]); const mu = x=> Math.exp(p*x); const prompt=`Solve the linear ODE $$y' + (${p})y = ${q},\qquad y(${x0})=${y0}.$$ Enter a function of <code>x</code> for $y(x)$.`; const hint=`Integrating factor $\mu(x)=e^{\int ${p}\,dx}=e^{${p}x}$. Then $(\mu y)' = \mu\,${q}$ ‚Üí $y = e^{- ${p}x}\big( \int ${q}e^{${p}x}\,dx + C\big)$. Use $y(${x0})=${y0}$.`; const sol = x=> (q/p) + (y0 - q/p)*Math.exp(-p*(x-x0)); const solutionHTML = `$$y(x)=\frac{${q}}{${p}} + \Big(${y0}-\frac{${q}}{${p}}\Big)e^{- ${p}(x-${x0})}.$$`; return {type:'func', var:'x', ic:{x0,y0}, prompt, hint, truth:sol, solutionHTML, ode:(x,y)=> -p*y + q} }

  // Growth/Decay y' = k y
  function gen_growth(){ const k=choice([-2,-1,-0.5,0.5,1,2]); const t0=0; const y0=choice([0.5,1,2,3]); const prompt=`Solve $$\dfrac{dy}{dt} = ${k}\,y,\quad y(${t0})=${y0}.$$ Enter $y(t)$.`; const hint=`$y'=ky \Rightarrow y=Ce^{kt}$. Use $y(0)=${y0}$ to get $C=${y0}$.`; const sol = t=> y0*Math.exp(k*(t-t0)); const solutionHTML = `$$y(t)=${y0}e^{${k}(t-${t0})}.$$`; return {type:'func', var:'t', ic:{t0,y0}, prompt, hint, truth:sol, solutionHTML, ode:(t,y)=> k*y} }

  // Newton Cooling T' = -k (T - Tenv)
  function gen_cooling(){ const k=choice([0.3,0.5,1.0]); const Tenv=choice([20,22,25,30]); const t0=0; const T0=choice([60,70,80]); const prompt=`Newton cooling: $$\dfrac{dT}{dt} = -${k}(T-${Tenv}),\quad T(${t0})=${T0}.$$ Enter $T(t)$.`; const hint=`Linear ODE with steady state $T= ${Tenv}$. Solution $T(t)=${Tenv}+ (T_0-${Tenv})e^{-kt}$.`; const sol = t=> Tenv + (T0 - Tenv)*Math.exp(-k*(t-t0)); const solutionHTML = `$$T(t)=${Tenv} + (${T0}-${Tenv})e^{- ${k}(t-${t0})}.$$`; return {type:'func', var:'t', ic:{t0:0,y0:T0}, prompt, hint, truth:sol, solutionHTML, ode:(t,T)=> -k*(T-Tenv)} }

  // Concept MCQ (Existence & Uniqueness)
  function gen_concept(){ const variants=[
    {q:`For the IVP $y' = \dfrac{1}{x}$, $y(0)=0$, existence/uniqueness near $x=0$?`,
     options:["No solution.","At least one solution, not unique.","Unique solution."], ans:0,
     why:"$f(x,y)=1/x$ is not continuous at $x=0$ ‚Üí the theorem's hypotheses fail."},
    {q:`For $y' = 2\sqrt{|y|}$ with $y(0)=0$, what happens?`,
     options:["Unique solution.","Infinite solutions.","No solutions."], ans:1,
     why:"Not Lipschitz in $y$ at $y=0$ ‚Üí non-uniqueness (e.g., $y\equiv 0$ and patched solutions)."},
    {q:`For $y' = x + y$ with $y(0)=2$, do we have uniqueness near $0$?`,
     options:["Yes, unique.","No, fails existence.","No, fails uniqueness."], ans:0,
     why:"$f$ and $\partial f/\partial y=1$ are continuous ‚Üí unique local solution."}
  ];
    const v=choice(variants);
    const prompt=`<div style="display:flex; align-items:center; gap:6px"><span>üí°</span><span>${v.q}</span></div>`;
    const hint=`Check continuity in a rectangle around the initial point; if yes, the existence‚Äìuniqueness theorem applies.`;
    const solutionHTML = `<b>Answer:</b> ${v.options[v.ans]}<br/><span class="small">${v.why}</span>`;
    return {type:'mcq', prompt, hint, solutionHTML, options:v.options, answer:v.ans}
  }

  const generators={ sep:gen_sep, lin:gen_lin, growth:gen_growth, cooling:gen_cooling, concept:gen_concept };

  // üå∑ app state
  let current=null; let topic='';
  function setTopic(t){ topic=t; document.querySelectorAll('.skill').forEach(el=>{ el.classList.toggle('active', el.dataset.topic===t); }); byId('feedback').textContent=''; byId('answer').value=''; byId('prompt').innerHTML='Press <span class="kbd">New Q</span> when ready üíñ'; byId('mcq').style.display='none'; latex(); }

  function newQ(){ if(!topic){ byId('feedback').innerHTML='<span class="warn">Pick a skill first ‚ú®</span>'; return } current = generators[topic](); byId('prompt').innerHTML = current.prompt; byId('hint').innerHTML=current.hint; byId('solution').innerHTML = `<div style="background:#fff0fa; border:1px solid var(--line); padding:10px; border-radius:12px">${current.solutionHTML}</div>`; byId('hintBox').open=false; byId('solnBox').open=false; byId('answer').value=''; if(current.type==='mcq'){ renderMCQ(current) } else { byId('mcq').style.display='none' } latex(); }

  function renderMCQ(c){ const box=byId('mcq'); box.style.display='block'; const opts = c.options.map((o,i)=>`<label style="display:block; margin:.3rem 0;"> <input type="radio" name="mc" value="${i}"> ${o} </label>`).join(''); box.innerHTML = `<div style="padding:10px; border:2px dashed #ffd4eb; border-radius:12px; background:#fff9fd">${opts}</div>`; }

  function check(){ if(!current){ byId('feedback').innerHTML='<span class="warn">Generate a question first ü™Ñ</span>'; return }
    if(current.type==='mcq'){ const picked=[...document.querySelectorAll('input[name="mc"]')].find(r=>r.checked); if(!picked){ byId('feedback').innerHTML='<span class="warn">Pick an option ‚ú®</span>'; return } const ok = Number(picked.value)===current.answer; bump(ok); byId('feedback').innerHTML = ok? '<span class="ok">‚úÖ correct! you‚Äôre glowing ‚ú®</span>' : '<span class="bad">‚ùå try again ‚Äî check the theorem conditions üí°</span>'; return }

    // function answers: verify ODE residual and IC
    const variable = current.var; const raw=byId('answer').value.trim(); const f=compileScalar(raw,[variable]); if(!f){ bump(false); return byId('feedback').innerHTML='<span class="bad">‚ö†Ô∏è I couldn‚Äôt parse your function. Use the variable '+variable+' and basic math like exp(), sin(), ^.</span>' }
    // test points
    const ts = [0, 0.4, 0.9, 1.3];
    let okAll=true, worst=0; for(const t of ts){ let y, dy; try{ y=f(t); dy=numDeriv(tt=>f(tt), t) }catch(e){ okAll=false; break } const rhs = current.ode(t,y); const resid = dy - rhs; worst=Math.max(worst, Math.abs(resid)); if(!isFinite(resid)) { okAll=false; break } }
    // IC check if present
    let okIC=true; if(current.ic){ const key=Object.keys(current.ic)[0]; const val=current.ic[key]; let y0; try{ y0=f(val) }catch(e){ y0=NaN } const target = current.ic.y0; if(target!==undefined){ okIC = Math.abs(y0-target) <= 1e-2*(1+Math.abs(target)); }
    }
    const ok = okAll && okIC && worst < 1e-2*(1+1);
    bump(ok);
    byId('feedback').innerHTML = ok? `<span class='ok'>‚úÖ slay!! your solution satisfies the ODE & IC (max residual ~ ${worst.toExponential(2)}) üå∏</span>` : `<span class='bad'>‚ùå not quite ‚Äî check your constants/IF. Residual ~ ${worst.toExponential(2)}. peek the hint üí°</span>`;
  }

  // üå∏ wire UI
  document.querySelectorAll('.skill').forEach(el=> el.addEventListener('click', ()=> setTopic(el.dataset.topic)) );
  byId('newQ').addEventListener('click', newQ);
  byId('check').addEventListener('click', check);
  byId('hintBtn').addEventListener('click', ()=> byId('hintBox').open=true);
  byId('solnBtn').addEventListener('click', ()=> byId('solnBox').open=true);
  byId('answer').addEventListener('keydown', (e)=>{ if(e.key==='Enter') check() });

  renderProgress(); latex();
  </script>
</body>
</html>
